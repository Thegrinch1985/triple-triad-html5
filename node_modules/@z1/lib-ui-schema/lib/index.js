var e,t,r,n,a=require("@z1/preset-task"),u=a.task(function(e){return e.compose(e.head,e.tail)}),i=a.task(function(e){return e.compose(e.map(function(t){return e.caseTo.camelCase(t)}),e.keys)}),o={ARRAY:"array",NUMBER:"number",INT:"integer",OBJECT:"object",STRING:"string",BOOL:"boolean",NULL:"null"},s=a.task(function(e){return e.mergeDeepRight(o,{KEY:{TITLE:"title",DESC:"description",TYPE:"type",FORMAT:"format",REQUIRED:"required",PROPS:"properties",ITEMS:"items",ENUM:"enum",ENUM_NAMES:"enumNames",UNIQUE:"uniqueNames",UNIQUE_ITEMS:"uniqueItems",DEFAULT:"default"},UI:{WIDGET:"ui:widget",FIELD:"ui:field",ORDER:"ui:order",PLACEHOLDER:"ui:placeholder",DISABLED:"ui:disabled",CSS:"classNames",ROOT_FIELD_ID:"rootFieldId",OPTIONS:"ui:options"},FORMAT:{EMAIL:"email",URL:"uri",DATA_URL:"data-url",DATE:"date",DATE_TIME:"date-time",ALT_DATE:"alt-date",ALT_DATE_TIME:"alt-datetime"},WIDGET:{RADIO:"radio",CHECKBOXES:"checkboxes",SELECT:"select",TEXT_AREA:"textarea",PASSWORD:"password",COLOR:"color",EMAIL:"email",URL:"uri",FILE:"data-url",DATE:"date",DATE_TIME:"date-time",ALT_DATE:"alt-date",ALT_DATE_TIME:"alt-datetime",UP_DOWN:"updown",RANGE:"range",DISABLED:"disabled",READ_ONLY:"readonly",HIDDEN:"hidden",HELP:"help",NUMBER:"number"}})}),c=a.task(function(e){return e.compose(e.fromPairs,e.map(function(t){return[e.path(["name"],t),e.path(["schema"],t)]}))}),f=a.task(function(e){return function(t,r){if(void 0===r&&(r={}),e.equals(e.type(t),"Array")){if(e.equals(e.length(t),0))return r;var n=e.head(t);return e.equals(e.length(t),1)?e.merge(r,n):f(e.tail(t),e.merge(r,n))}return e.equals(e.type(t),"Object")?e.merge(r,t):r}}),d=a.task(function(e){return function(t){var r=e.filter(function(t){return e.has("uiSchema")(t)},t),n=e.map(function(t){var r=e.path(["uiSchema"],t);return e.gt(e.length(e.keys(r)),1)?e.fromPairs(e.map(function(t){return[t,e.path([t],r)]},e.keys(r))):r},r);return f(n)}}),l=a.task(function(e){return function(t){return e.compose(e.map(function(e){return e.key}),e.filter(function(e){return e.required}),e.map(function(t){var r=t[1];return{key:t[0],required:!!e.has("required")(r)&&(!e.eq("Array",e.type(r.required))&&r.required)}}))(e.toPairs(t||{})||[])}}),m=a.task(function(e){return function(t){return e.compose(e.fromPairs,e.map(function(t){var r=t[0],n=t[1];return e.has("required")(n)?[r,e.omit(["required"],n)]:[r,n]}))(e.toPairs(t||{})||[])}}),E=a.task(function(n){return function(a,o,f){var E=i(s.KEY),h=n.toPairs(o),p=n.fromPairs(n.filter(function(e){return n.gt(n.findIndex(function(t){return n.equals(n.head(e),t)},E),-1)},h)),T=n.head(n.filter(function(e){return n.equals(n.head(e),"ui")},h)),I=n.gt(n.length(T),0)?n.fromPairs(n.filter(function(e){return!n.equals(n.head(e),"undefined")&&!n.isNil(n.head(e))},n.map(function(e){return[n.head(e),u(e)]},n.toPairs(u(T))))):{},A=n.isEmpty(n.path([s.KEY.TYPE],p))?n.isEmpty(f)||n.isNil(f)?s.STRING:n.equals(n.length(f),1)?s.ARRAY:s.OBJECT:n.path([s.KEY.TYPE],p),R=n.isEmpty(f)||n.isNil(f)?"":n.equals(A,s.OBJECT)?s.KEY.PROPS:s.KEY.ITEMS,g=n.isEmpty(R)?{}:c(f),O=n.equals(s.OBJECT,A)?n.merge(p,{required:l(g)}):p;return{name:a,schema:n.isEmpty(R)?n.merge(O,{type:A}):n.merge(O,((e={type:A})[R]=m(g),e)),uiSchema:n.isEmpty(I)||n.isNil(I)?n.gt(n.length(f),0)?d(f):{}:n.gt(n.length(f),0)?n.merge(((t={})[a]=I,t),d(f)):((r={})[a]=I,r)}}}),h=a.task(function(e){return function(t){var r=t(E,s),n=e.equals(e.type(r),"Array")?r:[r],a=c(n),u=e.keys(a);return{schema:e.equals(e.length(u),1)?e.path(u,a):a,uiSchema:d(n)}}}),p={PARENT:"parent",ORIGIN:"origin",ROOT:"root",CHILDREN:"children"},T=a.task(function(e){return function(t){return e.equals(e.last(t),"/")?e.dropLast(1,t):t}}),I=a.task(function(e){return function(t){return t?e.equals(e.head(t),"/")?T(t):"/"+T(t):""}}),A=a.task(function(e){return function(t,r){return e.equals(e.head(t),"/")?""+T(t)+I(r):"/"+T(t)+I(r)}}),R=a.task(function(e){return e.has(p.CHILDREN)}),g=a.task(function(e){return function(t,r,n){return function(a,u){var i={originPath:u||p.ROOT,parentPath:a||p.ROOT,path:void 0};if("Array"===e.type(t)){var o="";e.forEach(function(e){o=o+"/"+e},t),i=e.merge(i,{path:o})}else i=e.merge(i,{path:""!==t?A(t):u});if(n&&e.gt(e.length(n),0)){var s=e.map(function(e){return e(i.path,a)},n);i=e.merge(i,{children:s})}return e.merge(i,r||{})}}}),O=a.task(function(e){return function(t){return e.map(function(e){return e(p.ROOT,p.ROOT)},t(g,p))}}),q=function(e){return e&&R(e)?e.children:[]},D=a.task(function(e){return function(t,r){return!e.not(r)&&(e.eq(t,"/")?e.eq(r.path,t):r.path.includes(decodeURI(t)))}}),N=a.task(function(e){return function(t,r){return e.find(function(e){return D(t,e)},r)}}),S=a.task(function(e){return function(t,r){return e.concat(e.tail(t),r)}}),k=a.task(function(e){return function(t,r){var n=function(t,r){if(!e.equals(e.length(r),0)){if(e.equals(e.length(r),1)){var a=e.head(r);return D(t,a)?a:n(t,q(a))}var u=N(t,r);return u||n(t,S(r,e.compose(q,e.head)(r)))}};return n(t,r)}}),L={NODE:"@node",ui:function(e){return"@"+e},event:function(e){return"#"+e}},y=a.task(function(e){return function(t){var r=e.toPairs(t),n=e.find(function(t){return e.equals(e.head(t),"@node")},r),a=e.filter(function(t){return!e.equals(e.head(t),"@node")&&e.equals(e.head(e.head(t)),"@")},r),u=e.filter(function(t){return e.equals(e.head(e.head(t)),"#")},r),i=e.map(function(t){return e.head(t)},e.concat(a,u)),o=e.omit(e.concat(["@node"],i),t),s=function(t){return[""+e.tail(e.head(t)),e.head(e.tail(t))]};return{node:n?e.head(e.tail(n)):"Box",props:o,ui:e.fromPairs(e.map(s,a)),handlers:e.fromPairs(e.map(s,u))}}}),P=a.task(function(e){return function(t,r,a){void 0===t&&(t="view"),void 0===r&&(r={}),void 0===a&&(a=[]);var u=y(r),i=e.equals(e.type(a),"Array")?a:[],o=e.mapObjIndexed(function(t,r){return e.path([r],e.head(t))},e.groupBy(function(t){return e.head(e.head(e.toPairs(t)))})(i));return(n={})[t]=e.merge(u,{children:o}),n}});exports.FORM_SCHEMA=s,exports.formSchema=h,exports.navSchema=O,exports.matchedNavItem=k,exports.viewSchema=function(e){return e(P,a.task(function(e){return e.mergeDeepRight(L,{CHILDREN:P("Children")})}))},exports.VIEW_STATUS={INIT:"init",WAITING:"waiting",READY:"ready",TRANSMITTING:"transmitting",COMPLETE:"complete"},exports.CAPTURE_STATUS={INVALID:"invalid",ERROR:"error",SUCCESS:"success"};
//# sourceMappingURL=index.js.map
